<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문 및 결제 페이지</title>
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 500px; margin: auto; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        h1 { text-align: center; }
        .product-info { margin-bottom: 20px; }
        .product-info p { margin: 5px 0; font-size: 1.1em; }
        #payment-button { display: block; width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 1.2em; cursor: pointer; }
        #payment-button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<div class="container">
    <h1>주문하기</h1>
    <div class="product-info">
        <p><strong>상품명:</strong> 노르웨이 회전 의자</p>
        <p><strong>가격:</strong> 100원</p>
    </div>
    <button id="payment-button">결제하기</button>
</div>

<script>
    // 1. SDK 초기화
    // 실제 운영 시에는 발급받은 고객사 식별코드를 사용해야 합니다.
    // var IMP = window.IMP;
    IMP.init("imp57817656"); // 예: "imp00000000"

    document.getElementById("payment-button").addEventListener("click", requestPay);

    // 2. 결제 요청 함수
    function requestPay() {
        IMP.request_pay({
            // -------- ↓↓↓ 필수 파라미터 ↓↓↓ --------
            channelKey: 'channel-key-71fa9731-7a47-4cb1-b392-9c58611ee6cf', // 포트원 관리자 콘솔에서 발급받은 채널 키
            pay_method: "card", // 결제 수단
            merchant_uid: `20250708-1751977460136`, // 주문 고유 번호
            name: "노르웨이 회전 의자", // 주문명
            amount: 200, // 결제 금액
            buyer_email: "gildong@gmail.com",
            buyer_name: "홍길동",
            buyer_tel: "010-4242-4242",
            buyer_addr: "서울특별시 강남구 신사동",
            buyer_postcode: "01181",
            confirmUrl: "https://a2044749fc77.ngrok-free.app/payment/confirm",
            confirm_url: "https://a2044749fc77.ngrok-free.app/payment/confirm", // 결제 완료 후 호출되는 URL
        }, function (response) {
            // 3. 결제 후 호출되는 콜백 함수
            handlePaymentResponse(response);
        });
    }

    async function handlePaymentResponse(response) {
        const { success, error_code, error_msg, imp_uid, merchant_uid } = response;

        if (success) {
            // 결제 성공 시 로직
            alert("결제에 성공했습니다.");

            // 서버에 결제 정보를 전송하여 위변조를 검증합니다.
            // 실제 서버의 엔드포인트 URL로 변경해야 합니다.
            try {

                alert('최종 결제 처리가 완료되었습니다.');
                // window.location.href = "/payment-success-page"; // 성공 페이지로 이동

            } catch (e) {
                alert(`결제는 성공했으나 서버 검증에 실패했습니다.\n에러: ${e.message}\n고객센터로 문의해주세요.`);
            }

        } else {
            // 결제 실패 시 로직
            alert(`결제에 실패하였습니다. 에러 내용: ${error_msg}`);
        }
    }
</script>

</body>
</html>
